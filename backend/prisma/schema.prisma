generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER
  DRIVER
  SHOPPER
  CLEANER
  HAIR_DRESSER
  BEAUTY
  INSTITUTE
  ENGINEERING
  HUMAN_CARE
  LIFESTYLE
  IT_SERVICE
  LEGAL_SERVICE
  PROPERTY_CARE
  TUTOR
  PET_CARE
  REALTOR
  JOB1
  JOB2
  JOB3
  JOB4
}

enum UserRoleType {
  FAMILY_ADMIN
  FAMILY_MEMBER
  BUSINESS_ADMIN
  EMPLOYEE
  CUSTOMER
}

enum VehicleType {
  CAR
  DELIVERY
  TUKTUK
  LIMO
  TRUCK
  WATER_TRUCK
  TOW_TRUCK
  WHEELCHAIR
  PRIVATE_DRIVER
  SHOPPER

  HOME_CLEANING
  BUSINESS_CLEANING
  WINDOWS_CLEANING
  VEHICLE_CLEANING
  CARPET_CLEANING
  LAUNDRY

  MALE_HAIR_DRESSER
  FEMALE_HAIR_DRESSER
  MAKEUP
  FACIAL
  NAILS
  EYELASH
  BROWS
  WAXING
  SKIN_CARE

  CIVIL
  ARCHITECT
  INTERIOR
  MECHANICAL
  ELECTRICAL
  SURVEY
  ENVIRONMENTAL
  INDUSTRIAL
  CONSULTANT
  
  BABYSITTER
  ELDER_CARE
  PHYSIOTHERAPIST
  MASSAGE
  TRAINER
  SPIRITUAL_ADVISOR
  NUTRITION_DIET
  COUNSELING

  EVENT_PLANNER
  PHOTOGRAPHY
  DJ_MUSIC

  WEB_DESIGN
  SOCIAL_MEDIA
  SOFTWARE
  APP_DESIGN
  GRAPHIC_DESIGN
  SEO_MARKETING
  
  ERRAND_RUNNER
  ACCOUNTING
  DOCUMENT_AUTHENTICATION
  TAX_FILING
  NOTARY_PAPERWORK
  
  CARPENTER
  PLUMBER
  ELECTRICIAN
  INSULATION
  WATER_PROOFING
  PAINTER
  ROOFER
  DECORATOR
  LANDSCAPER
  GARDNER
  PEST_CONTROL
  FENCER
  FLOORING
  
  MATH
  SCIENCE
  PHYSICS
  CHEMISTRY
  HISTORY
  GEOGRAPHY
  CODING
  LANGUAGE
  GRAMMER
  ART
  MUSIC
  
  PET_SITTING
  PET_BATHING
  PET_WALKING
  PET_TRAINING
  PET_HAIR_CUTTING
  PET_NAIL_CLIPPING
  PET_TRANSPORTATION
  PET_BOARDING
  
  BUY
  SELL
  RENT
  OFFER_RENT
  
  BEAUTY
  JOB1
  JOB2
  JOB3
  JOB4
}

enum RideStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  SCHEDULED
  NO_SHOW
}

model ServiceCategory {
  id        Int               @id @default(autoincrement())
  name      String            @unique
  icon      String?
  subTypes  ServiceSubType[]
  rides     Ride[]            @relation("CategoryRides")
  createdAt DateTime          @default(now())
}

model ServiceSubType {
  id           Int                 @id @default(autoincrement())
  name         String
  icon         String?
  categoryId   Int
  category     ServiceCategory     @relation(fields: [categoryId], references: [id])
  rides        Ride[]              @relation("SubTypeRides")
  acceptedRoles ServiceSubTypeRole[]
  createdAt    DateTime            @default(now())
  @@unique([name, categoryId])
}

model ServiceSubTypeRole {
  id             Int           @id @default(autoincrement())
  subType        ServiceSubType @relation(fields: [subTypeId], references: [id])
  subTypeId      Int
  role           Role

  @@unique([subTypeId, role])
  @@index([role])
}

model User {
  id               Int             @id @default(autoincrement())
  name             String
  phone            String          @unique
  email            String?         @unique
  password         String
  role             Role
  vehicleType      VehicleType?
  isBusy           Boolean         @default(false)
  ridesAsDriver    Ride[]          @relation("DriverRides")
  ridesAsCustomer  Ride[]          @relation("CustomerRides")
  verificationCode String?
  phoneVerified    Boolean         @default(false)
  disabled         Boolean         @default(false)
  trustedDevices   TrustedDevice[]
  avatar           String?

  chatsAsCustomer  Chat[]          @relation("ChatCustomer")
  chatsAsDriver    Chat[]          @relation("ChatDriver")
  messages         Message[]

  trialStart             DateTime?      @map("trial_start")
  trialEnd               DateTime?      @map("trial_end")
  subscriptionStatus     String?        @default("trial")
  subscriptionFee        Float?         @default(0)
  paymentMethod          String?
  isSubscriptionDisabled Boolean?       @default(false)

  lat         Float?
  lng         Float?
  online      Boolean?      @default(false)
  country         String?
  countryName     String?
  area            String?

  lastKnownLat   Float?
  lastKnownLng   Float?
  lastLocationAt DateTime?

  roles          UserRole[]
  serviceProfile Json?

  hairType       String?
  beautyServices String?

  mainProviderCategory String?
}

model Ride {
  id                Int         @id @default(autoincrement())
  customer          User        @relation("CustomerRides", fields: [customerId], references: [id])
  customerId        Int
  driver            User?       @relation("DriverRides", fields: [driverId], references: [id])
  driverId          Int?
  originLat         Float
  originLng         Float
  destLat           Float
  destLng           Float
  destinationName   String?
  note              String?
  requestedAt       DateTime    @default(now())
  acceptedAt        DateTime?
  startedAt         DateTime?
  completedAt       DateTime?
  cancelledAt       DateTime?
  status            RideStatus  @default(PENDING)
  vehicleType       VehicleType?
  level String?  
  categoryName      String?
  subType           String?

  rating            Int?
  feedback          String?
  chat              Chat?
  scheduledAt       DateTime?
  noShowReportedAt  DateTime?
  imageUri          String?
  jobDetails        Json?

  serviceCategoryId Int?
  serviceCategory   ServiceCategory? @relation("CategoryRides", fields: [serviceCategoryId], references: [id])
  serviceSubTypeId  Int?
  serviceSubType    ServiceSubType?  @relation("SubTypeRides", fields: [serviceSubTypeId], references: [id])

  @@index([customerId])
  @@index([driverId])
  @@index([status])
  @@index([categoryName])
  @@index([subType])
}

model TrustedDevice {
  id        Int      @id @default(autoincrement())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  deviceId  String
  addedAt   DateTime @default(now())
  @@unique([userId, deviceId])
}

model Chat {
  id          Int       @id @default(autoincrement())
  ride        Ride      @relation(fields: [rideId], references: [id])
  rideId      Int       @unique
  customer    User      @relation("ChatCustomer", fields: [customerId], references: [id])
  customerId  Int
  driver      User      @relation("ChatDriver", fields: [driverId], references: [id])
  driverId    Int
  messages    Message[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([customerId])
  @@index([driverId])
}

model Message {
  id        Int      @id @default(autoincrement())
  chat      Chat     @relation(fields: [chatId], references: [id])
  chatId    Int
  sender    User     @relation(fields: [senderId], references: [id])
  senderId  Int
  content   String
  sentAt    DateTime @default(now())
}

model Family {
  id           Int                @id @default(autoincrement())
  name         String
  adminId      Int
  users        UserRole[]
  vehicles     Vehicle[]
  invitations  FamilyInvitation[]
  createdAt    DateTime           @default(now())
}

model Business {
  id           Int                   @id @default(autoincrement())
  name         String
  adminId      Int
  users        UserRole[]
  vehicles     Vehicle[]
  invitations  BusinessInvitation[]
  createdAt    DateTime              @default(now())
}

model UserRole {
  id         Int           @id @default(autoincrement())
  user       User          @relation(fields: [userId], references: [id])
  userId     Int
  family     Family?       @relation(fields: [familyId], references: [id])
  familyId   Int?
  business   Business?     @relation(fields: [businessId], references: [id])
  businessId Int?
  role       UserRoleType
  invitedBy  Int?
  phone      String?
  name       String?
  createdAt  DateTime      @default(now())

  @@index([userId])
  @@index([familyId])
  @@index([businessId])
}

model Vehicle {
  id         Int        @id @default(autoincrement())
  type       VehicleType
  family     Family?    @relation(fields: [familyId], references: [id])
  familyId   Int?
  business   Business?  @relation(fields: [businessId], references: [id])
  businessId Int?
}

model FamilyInvitation {
  id        Int      @id @default(autoincrement())
  family    Family   @relation(fields: [familyId], references: [id])
  familyId  Int
  phone     String
  name      String
  code      String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())
}

model BusinessInvitation {
  id         Int      @id @default(autoincrement())
  business   Business @relation(fields: [businessId], references: [id])
  businessId Int
  phone      String
  name       String
  code       String
  expiresAt  DateTime
  verified   Boolean  @default(false)
  createdAt  DateTime @default(now())
}